"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var path=_interopDefault(require("path")),fs=_interopDefault(require("fs")),glob=_interopDefault(require("glob")),babel=_interopDefault(require("@babel/core")),babelPluginSyntaxDynamicImport=_interopDefault(require("@babel/plugin-syntax-dynamic-import")),access=e=>new Promise((t,a)=>fs.access(e,s=>s?a(s):t([e]))),glob$1=(e,t,a)=>new Promise((s,r)=>glob(e,Object.assign({cwd:t,nodir:!0},a),(e,a)=>e?r(e):a.length?s(a.map(e=>path.join(t,e))):r(a))),json=([e])=>new Promise((t,a)=>fs.readFile(e,"utf8",(e,s)=>e?a(e):t(JSON.parse(s)))),resolve=(e,...t)=>Promise.all(getResolvedPromises(t)).then(()=>e.reduce((e,a,s)=>{const r=t[s-1];return`${e}${Array.isArray(r)?r.join(""):String(r)}${a}`}));const getResolvedPromises=e=>{const t=[];if(e&&"object"==typeof e)for(let a in e){let s=e[a];s instanceof Promise&&t.push(s.then(t=>{e[a]=t})),t.push.apply(t,getResolvedPromises(s))}return t};var transform=e=>babel.transform(`(function () {\n  "use strict";\n  return\`${e}\`;\n})();`,{plugins:[babelPluginSyntaxDynamicImport,()=>({visitor:{CallExpression(e){"Import"===e.node.callee.type&&e.replaceWith(babel.types.callExpression(babel.types.identifier("include"),e.node.arguments))},TemplateLiteral(e){e.parentPath.isTaggedTemplateExpression()||e.replaceWith(babel.types.taggedTemplateExpression(babel.types.identifier("include.resolve"),e.node))}}})]}).code.slice(14,-5);function parse(e="",t,a){const s=Object.assign({},t),r=Object.keys(s),n=r.map(e=>s[e]),i=(e,s,r)=>include(e,Object.assign({},t,s),Object.assign({},a,r));return i.parse=((e,s,r)=>parse(e,Object.assign({},t,s),Object.assign({},a,r))),i.resolve=resolve,new(Function.prototype.bind.call(Function,null,"include",...r))(transform(e))(i,...n)}var read=e=>new Promise((t,a)=>fs.readFile(e,"utf8",(e,s)=>e?a(e):t(s))),include=(e,t,a)=>{const s=Object(a),r=s.cwd,n=void 0===r?process.cwd():r,i=s.prefixes,o=void 0===i?["_"]:i,c=s.extensions,l=void 0===c?[".html",".jsx"]:c,p=s.globopts,u=void 0===p?{}:p,d=path.relative(n,path.isAbsolute(String(e))?e:path.join(n,String(e))),m=d.split(path.sep),b=n.split(path.sep),h=m.length>1;return[].concat(Array.isArray(l)?l.map(e=>["",e]):[]).concat(Array.isArray(o)?o.map(e=>[e,""]):[]).concat(Array.isArray(o)?o.map(e=>Array.isArray(l)?l.map(t=>[e,t]):[]):[]).reduce((e,[t,a])=>e.catch(()=>access(path.join(n,...h?m.slice(0,-1).concat(t+m.slice(-1)[0]+a):[t+d+a]))),access(path.join(n,d))).catch(()=>glob$1(d,n,u)).catch(()=>b.map((e,t)=>path.join(b.slice(0,t+1).join(path.sep),"node_modules",m[0],...h?m.slice(1):["package.json"])).reverse().reduce((e,t)=>e.catch(()=>h?access(t):access(t).then(json).then(e=>getPackageFile(path.dirname(t),e))),Promise.reject())).catch(()=>[]).then(e=>Promise.all(e.map(e=>read(e).catch(t=>"EISDIR"===t.code?json([path.join(e,"package.json")]).then(t=>getPackageFile(e,t).then(([e])=>read(e))):Promise.reject(t)))).then(s=>parse(s.join(""),t,Object.assign({},a,{cwd:path.dirname(e[0])}))))};const getPackageFile=(e,t)=>access(path.join(e,t.template||t.main||"index.html"));include.parse=parse,include.resolve=resolve,module.exports=include;
//# sourceMappingURL=index.js.map
