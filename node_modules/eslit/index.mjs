import e from"path";import t from"fs";import r from"glob";import n from"@babel/core";import i from"@babel/plugin-syntax-dynamic-import";var s=e=>new Promise((r,n)=>t.access(e,t=>t?n(t):r([e]))),o=([e])=>new Promise((r,n)=>t.readFile(e,"utf8",(e,t)=>e?n(e):r(JSON.parse(t)))),a=(e,...t)=>Promise.all(c(t)).then(()=>e.reduce((e,r,n)=>{const i=t[n-1];return`${e}${Array.isArray(i)?i.join(""):String(i)}${r}`}));const c=e=>{const t=[];if(e&&"object"==typeof e)for(let r in e){let n=e[r];n instanceof Promise&&t.push(n.then(t=>{e[r]=t})),t.push.apply(t,c(n))}return t};var p=e=>n.transform(`(function () {\n  "use strict";\n  return\`${e}\`;\n})();`,{plugins:[i,()=>({visitor:{CallExpression(e){"Import"===e.node.callee.type&&e.replaceWith(n.types.callExpression(n.types.identifier("include"),e.node.arguments))},TemplateLiteral(e){e.parentPath.isTaggedTemplateExpression()||e.replaceWith(n.types.taggedTemplateExpression(n.types.identifier("include.resolve"),e.node))}}})]}).code.slice(14,-5);function l(e="",t,r){const n=Object.assign({},t),i=Object.keys(n),s=i.map(e=>n[e]),o=(e,n,i)=>d(e,Object.assign({},t,n),Object.assign({},r,i));return o.parse=((e,n,i)=>l(e,Object.assign({},t,n),Object.assign({},r,i))),o.resolve=a,new(Function.prototype.bind.call(Function,null,"include",...i))(p(e))(o,...s)}var m=e=>new Promise((r,n)=>t.readFile(e,"utf8",(e,t)=>e?n(e):r(t))),d=(t,n,i)=>{const a=Object(i),c=a.cwd,p=void 0===c?process.cwd():c,d=a.prefixes,j=void 0===d?["_"]:d,h=a.extensions,g=void 0===h?[".html",".jsx"]:h,y=a.globopts,f=void 0===y?{}:y,b=e.relative(p,e.isAbsolute(String(t))?t:e.join(p,String(t))),v=b.split(e.sep),A=p.split(e.sep),x=v.length>1;return[].concat(Array.isArray(g)?g.map(e=>["",e]):[]).concat(Array.isArray(j)?j.map(e=>[e,""]):[]).concat(Array.isArray(j)?j.map(e=>Array.isArray(g)?g.map(t=>[e,t]):[]):[]).reduce((t,[r,n])=>t.catch(()=>s(e.join(p,...x?v.slice(0,-1).concat(r+v.slice(-1)[0]+n):[r+b+n]))),s(e.join(p,b))).catch(()=>((t,n,i)=>new Promise((s,o)=>r(t,Object.assign({cwd:n,nodir:!0},i),(t,r)=>t?o(t):r.length?s(r.map(t=>e.join(n,t))):o(r))))(b,p,f)).catch(()=>A.map((t,r)=>e.join(A.slice(0,r+1).join(e.sep),"node_modules",v[0],...x?v.slice(1):["package.json"])).reverse().reduce((t,r)=>t.catch(()=>x?s(r):s(r).then(o).then(t=>u(e.dirname(r),t))),Promise.reject())).catch(()=>[]).then(t=>Promise.all(t.map(t=>m(t).catch(r=>"EISDIR"===r.code?o([e.join(t,"package.json")]).then(e=>u(t,e).then(([e])=>m(e))):Promise.reject(r)))).then(r=>l(r.join(""),n,Object.assign({},i,{cwd:e.dirname(t[0])}))))};const u=(t,r)=>s(e.join(t,r.template||r.main||"index.html"));d.parse=l,d.resolve=a;export default d;
//# sourceMappingURL=index.mjs.map
